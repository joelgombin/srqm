%% -- lite version of Thomas Kastner's HK Beamer theme
%% -- https://github.com/sprungknoedl/hk-template

\DeclareOptionBeamer{compress}{\beamer@compresstrue}
\ProcessOptionsBeamer

\mode<presentation>

%% -- outer theme
%% -- replaces \useoutertheme{hk}

\RequirePackage{tikz}
\RequirePackage{ifthen}
\RequirePackage{etoolbox}
\RequirePackage{hyperref}

%% -- fonts
%% -- taken from the .tex sources

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\RequirePackage{lmodern}
\RequirePackage{inconsolata} % keep after lmodern

%% -- stuff
%% -- originally from beamerthemehk

\csdef{partimg}{}
\csdef{partsrc}{}
\newcommand{\setimage}[1]{ \csdef{partimg}{#1} }
\newcommand{\setsource}[1]{ \csdef{partsrc}{#1} }

\providecommand{\absoluteimage}[1]{}
\renewcommand{\absoluteimage}[1]{
  \begin{tikzpicture}[remember picture, overlay]
    \path[use as bounding box] (0, 0) rectangle (\paperwidth, \paperheight);
    \node[yshift=-\paperheight] at (current page.north west) {%
    \begin{tikzpicture}[remember picture, overlay]
        #1
    \end{tikzpicture}
    };
  \end{tikzpicture}}

\defbeamertemplate*{title page}{hk theme}{
  \absoluteimage{ 
    \usebeamercolor{palette primary}
    %\draw[draw=bg, fill=bg] (0, 0) rectangle (\paperwidth, \paperheight);

    %\node[anchor=west] at (1cm, 7cm) { \insertshorttitle };
    \node[anchor=west] at (1cm, 7.5cm) { \LARGE \color{bg} \inserttitle };
    % \node[anchor=east] at (\paperwidth-1cm, 5.5cm) { };

    %\usebeamercolor{palette secondary}
    \draw[draw=bg,fill=bg] (0, 0) rectangle (\paperwidth, 1cm);
    \node[anchor=west] at (.5cm, .5cm) { \color{fg} \url{http://f.briatte.org/teaching/quanti/}};
    \node[anchor=east] at (\paperwidth-.5cm, .5cm) { \color{fg} \texttt{\insertdate}};
}}

\defbeamertemplate*{part page}{hk theme}{
  \usebeamercolor{normal text}

  \ifdefempty{\partimg} { % no image specified, draw default part page
    \begin{centering}
      {\usebeamerfont{part name}\usebeamercolor[fg]{part name}\partname~\insertromanpartnumber}
      \vskip1em\par
      \begin{beamercolorbox}[sep=16pt,center]{part title}
        \usebeamerfont{part title}\insertpart\par
      \end{beamercolorbox}
    \end{centering}
  }{                      % image specified, make fancy part page
    \absoluteimage{
      \node at (current page.center) {\includegraphics[width=\paperwidth,height=\paperheight]{\partimg}};
      \node[anchor=east, fill=bg, inner sep=4mm] at (current page.east) {\usebeamerfont{part title}\insertpart\ >>};
      \ifdefempty{\partsrc}{}{ % only draw image source if given
        \node[anchor=south east, fill=bg, inner sep=1mm] at (current page.south east) { \color{fg} \tiny Bild: \emph{\partsrc}};
      }
    }
  }
}

\defbeamertemplate*{headline}{hk theme}{
  % \usebeamercolor{palette primary}
  % \absoluteimage{
  %   \node[anchor=north, fill=bg, minimum width=0.5cm, minimum height=.7cm] 
  %       at (1, \paperheight) 
  %       {\color{fg} \insertframenumber};
  % }
}

\defbeamertemplate*{footline}{hk theme}{
  % \usebeamercolor{palette primary}
  % \absoluteimage{
  %   \draw[draw=bg,fill=bg] (0, 0) rectangle (\paperwidth, .6cm);
  % 
  %   \node[anchor=west] at (0.5cm, 0.3cm) {\color{fg} \textsc{srqm session \insertshorttitle}: \inserttitle };
  %   \node[anchor=east] at (\paperwidth-0.5cm, 0.3cm) {\color{fg} \insertdate};
  % }
}

\defbeamertemplate*{frametitle}{hk theme}{
	\usebeamercolor{palette primary}
	\absoluteimage{
	  \node[anchor=west, minimum width=0.5cm, minimum height=.7cm] 
	      at (.5, \paperheight-1cm) 
	      {\color{bg} \insertframetitle };
	}
	\vspace{2em}
}

\defbeamertemplate*{navigation symbols}{hk theme}{
}

%% -- color theme
%% -- replaces \usecolortheme{hk}

\definecolor{hkblue}{HTML}{214478}

\setbeamercolor{palette primary}{fg=white, bg=hkblue}
\setbeamercolor{structure}{bg=white, fg=hkblue}

\setbeamercolor{frametitle}{fg=black}
\setbeamercolor{item}{fg=black}
% \setbeamercolor{subitem}{fg=hkblue}
\setbeamercolor{itemize/enumerate subbody}{fg=hkblue}

\setbeamercolor{section number projected}{bg=hkblue,fg=white}
\setbeamercolor{item projected}{bg=hkblue,fg=white}

\setbeamerfont{block title}{family=\sf}
\setbeamerfont{frametitle}{family=\sf}

\setbeamerfont{frametitle}{series=\bfseries,size=\Large}
\setbeamerfont{block title}{series=\bfseries}

\usecolortheme{rose}

%% -- custom red color (orange-red)

\definecolor{or}{rgb}{0.85,0.15,0}
\newcommand{\red}[1]{\textcolor{or}{#1}}

%% -- custom href color (purple-ish)

\definecolor{bl}{rgb}{0.25,0.25,0.75}

\let\oldhref\href
\renewcommand\href[2]{\color{bl}\oldhref{#1}{#2}\color{fg}}

%% -- inner theme

\useinnertheme{rectangles}

%% -- images

\graphicspath{{images/}}

\mode<all>
